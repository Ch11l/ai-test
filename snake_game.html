<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇游戏</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #111827;
            /* Dark background */
            font-family: 'Inter', sans-serif;
            color: white;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 8px;
            overflow: hidden;
        }

        canvas {
            display: block;
            background-color: #1f2937;
            /* Slightly lighter dark for canvas board */
        }

        #score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        #start-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            font-size: 1.2rem;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .hidden {
            opacity: 0;
        }
    </style>
</head>

<body>

    <div id="score-display">分数: 0</div>

    <div id="game-container">
        <canvas id="gameCanvas" width="500" height="500"></canvas>
        <div id="start-message">
            按任意方向键开始游戏
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score-display');
        const startMessage = document.getElementById('start-message');

        const GRID_SIZE = 20;
        const TILE_COUNT = canvas.width / GRID_SIZE; // 25x25 grid

        let score = 0;
        let snake = [
            { x: 10, y: 10 },
            { x: 9, y: 10 },
            { x: 8, y: 10 }
        ];
        let velocity = { x: 0, y: 0 };
        let food = { x: 15, y: 15 };
        let gameRunning = false;
        let gameSpeed = 100;
        let lastRenderTime = 0;

        // Colors
        const COLORS = {
            snakeHead: '#22c55e', // Green 500
            snakeBody: '#4ade80', // Green 400
            food: '#ef4444',      // Red 500
            canvasBg: '#1f2937'
        };

        function drawRect(x, y, color, shadow = false) {
            ctx.fillStyle = color;
            if (shadow) {
                ctx.shadowBlur = 10;
                ctx.shadowColor = color;
            } else {
                ctx.shadowBlur = 0;
            }
            ctx.fillRect(x * GRID_SIZE, y * GRID_SIZE, GRID_SIZE - 2, GRID_SIZE - 2);
            ctx.shadowBlur = 0; // Reset
        }

        function drawGame() {
            // Clear screen
            ctx.fillStyle = COLORS.canvasBg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Food
            drawRect(food.x, food.y, COLORS.food, true);

            // Draw Snake
            snake.forEach((segment, index) => {
                const isHead = index === 0;
                drawRect(segment.x, segment.y, isHead ? COLORS.snakeHead : COLORS.snakeBody, isHead);
            });
        }

        function placeFood() {
            food = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT)
            };
            // Prevent food spawning on snake
            if (snake.some(segment => segment.x === food.x && segment.y === food.y)) {
                placeFood();
            }
        }

        function resetGame() {
            snake = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
                { x: 8, y: 10 }
            ];
            velocity = { x: 0, y: 0 };
            score = 0;
            scoreElement.textContent = `分数: ${score}`;
            gameRunning = false;
            startMessage.classList.remove('hidden');
            placeFood();
            drawGame();
        }

        function update() {
            if (!gameRunning) return;

            const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };

            // Wall Collision Check
            if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                resetGame();
                return;
            }

            // Self Collision Check
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                resetGame();
                return;
            }

            snake.unshift(head); // Add new head

            // Check if ate food
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreElement.textContent = `分数: ${score}`;
                placeFood();
                // Optionally increase speed
            } else {
                snake.pop(); // Remove tail
            }
        }

        function gameLoop(currentTime) {
            window.requestAnimationFrame(gameLoop);

            const secondsSinceLastRender = (currentTime - lastRenderTime) / 1000;
            if (secondsSinceLastRender < 1 / (1000 / gameSpeed)) return;

            lastRenderTime = currentTime;

            if (gameRunning) {
                update();
            }
            drawGame();
        }

        // Input handling
        window.addEventListener('keydown', e => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
            }

            switch (e.key) {
                case 'ArrowUp':
                    if (velocity.y === 0) {
                        velocity = { x: 0, y: -1 };
                        if (!gameRunning) startGame();
                    }
                    break;
                case 'ArrowDown':
                    if (velocity.y === 0) {
                        velocity = { x: 0, y: 1 };
                        if (!gameRunning) startGame();
                    }
                    break;
                case 'ArrowLeft':
                    if (velocity.x === 0) {
                        velocity = { x: -1, y: 0 };
                        if (!gameRunning) startGame();
                    }
                    break;
                case 'ArrowRight':
                    if (velocity.x === 0) {
                        velocity = { x: 1, y: 0 };
                        if (!gameRunning) startGame();
                    }
                    break;
            }
        });

        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                startMessage.classList.add('hidden');
            }
        }

        // Initial Draw
        resetGame();
        window.requestAnimationFrame(gameLoop);

    </script>
</body>

</html>